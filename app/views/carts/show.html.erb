<ul class='list-group'>
	<% @cart.cart_items.each do |cart_item| %>
		<li class='list-group-item'>
			<h5><%= cart_item.product.name %></h5>

			<%= simple_form_for(cart_item) do |f| %>
				<%= f.input :quantity, value: cart_item.quantity %>

				<%= f.submit %>
			<% end %>

			<%= link_to cart_item_path(id: cart_item.id), method: :delete, class: "text-danger" do %>
				<%= fa_icon "times-circle" %>
			<% end %>
		</li>
	<% end %>
</ul>

<button id="checkout_button" class="btn btn-success">
	Checkout
</button>

<!-- Get this outta here -->
<script>
	document.addEventListener("turbolinks:load", () => {
		document.getElementById("checkout_button")
		.addEventListener("click", (event) => {
			fetch("<%= new_stripe_checkout_path %>")
			.then(response => response.json())
			.then((json) => {
				const stripe = Stripe('pk_test_Y2HGxcv4B58lA5tEakifsdiC00JK3c15ec');

				stripe.redirectToCheckout({
				  sessionId: json.session_id
				}).then(function (result) {
				  // If `redirectToCheckout` fails due to a browser or network
				  // error, display the localized error message to your customer
				  // using `result.error.message`.
				  console.log(result.error.message)
				});
			})
		})
	})
</script>